# Инструкции по деплою на Render.com

## Обзор
Этот проект настроен для раздельного деплоя фронтенда и бэкенда на Render.com. Фронтенд будет развернут как статический сайт, а бэкенд как Python веб-сервис.

## Варианты деплоя

### Вариант 1: Монорепо (рекомендуемый)
Используйте один репозиторий с файлом `render.yaml` для автоматического создания обоих сервисов.

### Вариант 2: Раздельные репозитории
Разделите фронтенд и бэкенд на отдельные репозитории для независимого деплоя.

## Структура деплоя

### 1. Бэкенд сервис (`pickup-portcomfort-backend`)
- **Тип**: Web Service (Python)
- **План**: Free
- **Build Command**: `pip install -r backend/requirements.txt` (монорепо) или `pip install -r requirements.txt` (отдельный репозиторий)
- **Start Command**: `cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT` (монорепо) или `uvicorn main:app --host 0.0.0.0 --port $PORT` (отдельный репозиторий)
- **Health Check**: `/api/settings`

### 2. Фронтенд сервис (`pickup-2gostya`)
- **Тип**: Static Site
- **Build Command**: `cd frontend && npm install && npm run build` (монорепо) или `npm install && npm run build` (отдельный репозиторий)
- **Static Publish Path**: `frontend/build` (монорепо) или `build` (отдельный репозиторий)

## Шаги для деплоя

### Вариант 1: Монорепо

#### Шаг 1: Подготовка репозитория
1. Убедитесь, что файл `render.yaml` находится в корне репозитория
2. Запушьте код в GitHub/GitLab репозиторий

#### Шаг 2: Создание сервисов через Blueprint
1. Войдите в [Render.com](https://render.com)
2. Нажмите "New +" → "Blueprint"
3. Подключите ваш Git репозиторий
4. Render автоматически создаст оба сервиса согласно `render.yaml`

#### Шаг 3: Настройка переменных окружения
1. Перейдите в настройки бэкенд сервиса
2. В разделе "Environment Variables" добавьте:
   - `GOOGLE_CREDENTIALS` - ваши Google API credentials (JSON)
3. Переменная `CORS_ORIGIN` уже настроена в `render.yaml`
4. Переменная `REACT_APP_API_URL` уже настроена в `render.yaml`

### Вариант 2: Раздельные репозитории

#### Для бэкенда:
1. Создайте отдельный репозиторий для бэкенда
2. Скопируйте папку `backend/` в корень нового репозитория
3. Переименуйте `backend-repo-render.yaml` в `render.yaml`
4. Запушьте в GitHub/GitLab
5. На Render.com создайте Web Service из этого репозитория
6. Настройте переменные окружения:
   - `GOOGLE_CREDENTIALS` - ваши Google API credentials (JSON)
   - `CORS_ORIGIN` - `https://pickup-2gostya.onrender.com`

#### Для фронтенда:
1. Создайте отдельный репозиторий для фронтенда
2. Скопируйте папку `frontend/` в корень нового репозитория
3. Переименуйте `frontend-repo-render.yaml` в `render.yaml`
4. Запушьте в GitHub/GitLab
5. На Render.com создайте Static Site из этого репозитория
6. Настройте переменную окружения:
   - `REACT_APP_API_URL` - `https://pickup-portcomfort-backend.onrender.com`

## Автоматический деплой

При каждом пуше в основную ветку репозитория, Render автоматически:
1. Обнаружит изменения
2. Запустит новый деплой
3. Обновит сервисы

## Проверка деплоя

### Проверка бэкенда:
- Откройте `https://pickup-portcomfort-backend.onrender.com/api/settings`
- Должен вернуться JSON ответ (возможно с ошибкой авторизации, что нормально)

### Проверка фронтенда:
- Откройте `https://pickup-2gostya.onrender.com`
- Должна загрузиться страница входа

## Устранение неполадок

### Проблемы с бэкендом:
1. Проверьте логи в разделе "Logs" сервиса
2. Убедитесь, что все зависимости установлены
3. Проверьте переменные окружения

### Проблемы с фронтендом:
1. Проверьте, что `REACT_APP_API_URL` правильно настроен
2. Убедитесь, что сборка проходит успешно
3. Проверьте консоль браузера на ошибки

### Проблемы с CORS:
1. Убедитесь, что `CORS_ORIGIN` в бэкенде содержит правильный URL фронтенда
2. Проверьте, что фронтенд использует правильный API URL

## Мониторинг

- Используйте встроенные метрики Render для мониторинга производительности
- Настройте уведомления о сбоях деплоя
- Регулярно проверяйте логи сервисов 